~~~sqlite

create table category
(
    id          INTEGER not null
        primary key autoincrement,
    title       TEXT    not null,
    icon        TEXT,
    color_theme TEXT
);

create table project
(
    id                     INTEGER not null
        primary key autoincrement,
    category_id            INTEGER not null
        references category
            on delete cascade,
    name                   TEXT    not null,
    icon                   TEXT,
    description            TEXT,
    color_theme            TEXT,
    enable_numeric_record  INTEGER not null,
    enable_option_record   INTEGER not null,
    enable_step_record     INTEGER not null,
    enable_location_record INTEGER not null,
    enable_media_record    INTEGER not null,
    enable_start_record    INTEGER not null,
    enable_notification    INTEGER not null,
    is_archived            INTEGER not null,
    is_hidden              INTEGER not null,
    sort_weight            INTEGER not null,
    updated_at             TEXT    not null,
    created_at             TEXT    not null,
    check ("enable_location_record" IN (0, 1)),
    check ("enable_media_record" IN (0, 1)),
    check ("enable_notification" IN (0, 1)),
    check ("enable_numeric_record" IN (0, 1)),
    check ("enable_option_record" IN (0, 1)),
    check ("enable_start_record" IN (0, 1)),
    check ("enable_step_record" IN (0, 1)),
    check ("is_archived" IN (0, 1)),
    check ("is_hidden" IN (0, 1))
);

create table numeric_field
(
    id         INTEGER not null
        primary key autoincrement,
    project_id INTEGER not null
        references project
            on delete cascade,
    title      TEXT    not null,
    unit       TEXT
);

create table option_field
(
    id             INTEGER not null
        primary key autoincrement,
    project_id     INTEGER not null
        references project
            on delete cascade,
    title          TEXT    not null,
    option_count   INTEGER not null,
    max_selections INTEGER not null,
    options_list   TEXT    not null
);

create table records
(
    id          INTEGER not null
        primary key autoincrement,
    project_id  INTEGER not null
        references project
            on delete cascade,
    title       TEXT    not null,
    content     TEXT,
    step_index  INTEGER,
    is_archived INTEGER not null,
    is_hidden   INTEGER not null,
    updated_at  TEXT    not null,
    created_at  TEXT    not null,
    check ("is_archived" IN (0, 1)),
    check ("is_hidden" IN (0, 1))
);

create table location_record
(
    id            INTEGER not null
        primary key autoincrement,
    project_id    INTEGER not null
        references project
            on delete cascade,
    record_id     INTEGER not null
        references records
            on delete cascade,
    location_name TEXT    not null,
    accuracy      REAL    not null,
    longitude     REAL    not null,
    latitude      REAL    not null,
    created_at    TEXT    not null
);

create table media_record
(
    id               INTEGER not null
        primary key autoincrement,
    project_id       INTEGER not null
        references project
            on delete cascade,
    record_id        INTEGER not null
        references records
            on delete cascade,
    storage_root_dir TEXT    not null,
    storage_dir      TEXT    not null,
    metadata         TEXT    not null,
    created_at       TEXT    not null
);

create table record_numeric_value
(
    id               INTEGER not null
        primary key autoincrement,
    project_id       INTEGER not null
        references project
            on delete cascade,
    record_id        INTEGER not null
        references records
            on delete cascade,
    numeric_field_id INTEGER not null
        references numeric_field
            on delete cascade,
    value            REAL    not null
);

create table record_option_selection
(
    id               INTEGER not null
        primary key autoincrement,
    project_id       INTEGER not null
        references project
            on delete cascade,
    record_id        INTEGER not null
        references records
            on delete cascade,
    option_field_id  INTEGER not null
        references option_field
            on delete cascade,
    selected_options TEXT    not null
);

create table step_definition
(
    id                    INTEGER not null
        primary key autoincrement,
    project_id            INTEGER not null
        references project
            on delete cascade,
    step_number           INTEGER not null,
    title                 TEXT    not null,
    description           TEXT,
    enable_numeric_record INTEGER not null,
    enable_option_record  INTEGER not null,
    enable_media_record   INTEGER not null,
    updated_at            TEXT    not null,
    created_at            TEXT    not null,
    check ("enable_media_record" IN (0, 1)),
    check ("enable_numeric_record" IN (0, 1)),
    check ("enable_option_record" IN (0, 1))
);

create table record_step
(
    id                 INTEGER not null
        primary key autoincrement,
    project_id         INTEGER not null
        references project
            on delete cascade,
    record_id          INTEGER not null
        references records
            on delete cascade,
    step_definition_id INTEGER not null
        references step_definition
            on delete cascade,
    step_number        INTEGER not null
);

create table tag
(
    id          INTEGER not null
        primary key autoincrement,
    title       TEXT    not null,
    icon        TEXT,
    color_theme TEXT
);

create table record_tag
(
    id         INTEGER not null
        primary key autoincrement,
    project_id INTEGER not null
        references project
            on delete cascade,
    record_id  INTEGER not null
        references records
            on delete cascade,
    tag_id     INTEGER not null
        references tag
            on delete cascade
);


~~~