~~~sql
-- 创建分类表
CREATE TABLE IF NOT EXISTS categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    name TEXT NOT NULL,                          -- 分类名称
    description TEXT,                            -- 分类描述
    color TEXT,                                  -- 显示颜色
    icon TEXT,                                   -- 图标标识
    sort_order INTEGER DEFAULT 0,                -- 排序权重
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP  -- 更新时间
);

-- 创建记录类型表
CREATE TABLE IF NOT EXISTS record_types (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    name TEXT NOT NULL,                          -- 记录类型名称
    category_id INTEGER,                         -- 所属分类ID
    description TEXT,                            -- 描述信息
    icon TEXT,                                   -- 图标
    color TEXT,                                  -- 颜色
    is_enabled BOOLEAN DEFAULT 1,                -- 是否启用
    sort_order INTEGER DEFAULT 0,                -- 排序权重
    require_photo BOOLEAN DEFAULT 0,             -- 是否需要拍照
    max_photos INTEGER DEFAULT 10,               -- 最大照片数量
    require_location BOOLEAN DEFAULT 0,          -- 是否需要定位
    location_accuracy TEXT DEFAULT 'high',       -- 定位精度
    location_timeout INTEGER DEFAULT 30000,      -- 定位超时时间
    has_timer BOOLEAN DEFAULT 0,                 -- 是否有计时器
    timer_duration INTEGER DEFAULT 0,            -- 计时器持续时间
    has_notes BOOLEAN DEFAULT 0,                 -- 是否有备注
    has_attachments BOOLEAN DEFAULT 0,           -- 是否有附件
    has_audio_recording BOOLEAN DEFAULT 0,       -- 是否有音频录制
    max_audio_duration INTEGER DEFAULT 60000,    -- 最大音频时长
    has_video_recording BOOLEAN DEFAULT 0,       -- 是否有视频录制
    max_video_duration INTEGER DEFAULT 60000,    -- 最大视频时长
    show_duration BOOLEAN DEFAULT 0,             -- 是否显示持续时间
    show_start_time BOOLEAN DEFAULT 1,           -- 是否显示开始时间
    show_end_time BOOLEAN DEFAULT 1,             -- 是否显示结束时间
    has_subtasks BOOLEAN DEFAULT 0,              -- 是否有子任务
    has_numeric_values BOOLEAN DEFAULT 0,        -- 是否有数值记录
    has_text_values BOOLEAN DEFAULT 0,           -- 是否有文本记录
    has_selection_values BOOLEAN DEFAULT 0,      -- 是否有选择项记录
    selection_options TEXT,                      -- 选择项配置JSON
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 更新时间
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL
);

-- 创建主记录表
CREATE TABLE IF NOT EXISTS records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    title TEXT,                                  -- 记录标题
    content TEXT,                                -- 记录内容
    start_time DATETIME,                         -- 开始时间
    end_time DATETIME,                           -- 结束时间
    duration_seconds INTEGER,                    -- 持续时间（秒）
    location_name TEXT,                          -- 位置名称
    latitude REAL,                               -- 纬度
    longitude REAL,                              -- 经度
    accuracy REAL,                               -- 定位精度
    status TEXT DEFAULT 'draft',                 -- 状态
    tags_json TEXT,                              -- 标签JSON数组
    metadata_json TEXT,                          -- 元数据JSON
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 更新时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建数值记录表
CREATE TABLE IF NOT EXISTS record_values (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_id INTEGER NOT NULL,                  -- 关联记录ID
    field_name TEXT NOT NULL,                    -- 字段名称
    field_value REAL,                            -- 数值
    field_text_value TEXT,                       -- 文本值
    field_type TEXT DEFAULT 'numeric',           -- 值类型
    unit TEXT,                                   -- 单位
    value_type TEXT DEFAULT 'decimal',           -- 值类型
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建分步记录表
CREATE TABLE IF NOT EXISTS record_steps (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_id INTEGER NOT NULL,                  -- 关联记录ID
    step_name TEXT NOT NULL,                     -- 步骤名称
    step_order INTEGER NOT NULL,                 -- 步骤顺序
    step_status TEXT DEFAULT 'pending',          -- 步骤状态
    completed_at DATETIME,                       -- 完成时间
    note TEXT,                                   -- 备注
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建照片记录表
CREATE TABLE IF NOT EXISTS record_photos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_id INTEGER NOT NULL,                  -- 关联记录ID
    photo_path TEXT,                             -- 照片路径
    photo_url TEXT,                              -- 照片URL
    thumbnail_path TEXT,                         -- 缩略图路径
    description TEXT,                            -- 照片描述
    width INTEGER,                               -- 图片宽度
    height INTEGER,                              -- 图片高度
    file_size INTEGER,                           -- 文件大小
    sort_order INTEGER DEFAULT 0,                -- 排序权重
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建位置记录表
CREATE TABLE IF NOT EXISTS record_locations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_id INTEGER NOT NULL,                  -- 关联记录ID
    latitude REAL,                               -- 纬度
    longitude REAL,                              -- 经度
    address TEXT,                                -- 详细地址
    location_name TEXT,                          -- 位置名称
    accuracy REAL,                               -- 定位精度
    altitude REAL,                               -- 海拔高度
    speed REAL,                                  -- 移动速度
    heading REAL,                                -- 方向角度
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建标签记录表
CREATE TABLE IF NOT EXISTS record_tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_id INTEGER NOT NULL,                  -- 关联记录ID
    tag_name TEXT NOT NULL,                      -- 标签名称
    tag_color TEXT,                              -- 标签颜色
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建分类记录关联表
CREATE TABLE IF NOT EXISTS category_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    category_id INTEGER NOT NULL,                -- 分类ID
    record_id INTEGER NOT NULL,                  -- 记录ID
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    UNIQUE(category_id, record_id),              -- 唯一约束
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE,
    FOREIGN KEY (record_id) REFERENCES records(id) ON DELETE CASCADE
);

-- 创建记录类型配置表
CREATE TABLE IF NOT EXISTS record_type_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    config_key TEXT NOT NULL,                    -- 配置键
    config_value TEXT,                           -- 配置值
    config_type TEXT DEFAULT 'string',           -- 配置类型
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 更新时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建分步配置表
CREATE TABLE IF NOT EXISTS record_step_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    step_name TEXT NOT NULL,                     -- 步骤名称
    step_description TEXT,                       -- 步骤描述
    step_order INTEGER NOT NULL,                 -- 步骤顺序
    required BOOLEAN DEFAULT 0,                  -- 是否必需
    allow_skip BOOLEAN DEFAULT 1,                -- 是否允许跳过
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建数值配置表
CREATE TABLE IF NOT EXISTS record_value_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    field_name TEXT NOT NULL,                    -- 字段名称
    field_label TEXT,                            -- 字段标签
    field_type TEXT DEFAULT 'numeric',           -- 字段类型
    unit TEXT,                                   -- 单位
    min_value REAL,                              -- 最小值
    max_value REAL,                              -- 最大值
    default_value REAL,                          -- 默认值
    selection_options TEXT,                      -- 选择项配置
    is_required BOOLEAN DEFAULT 0,               -- 是否必需
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建标签配置表
CREATE TABLE IF NOT EXISTS tag_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    tag_name TEXT NOT NULL,                      -- 预设标签名称
    tag_color TEXT,                              -- 标签颜色
    is_preset BOOLEAN DEFAULT 0,                 -- 是否预设标签
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建照片配置表
CREATE TABLE IF NOT EXISTS photo_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    max_photos INTEGER DEFAULT 10,               -- 最大照片数量
    require_photo BOOLEAN DEFAULT 0,             -- 是否必需拍照
    photo_quality TEXT DEFAULT 'medium',         -- 照片质量设置
    allow_multiple BOOLEAN DEFAULT 1,            -- 是否允许多张照片
    enable_thumbnail BOOLEAN DEFAULT 1,          -- 是否启用缩略图
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);

-- 创建位置配置表
CREATE TABLE IF NOT EXISTS location_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,        -- 主键，自增ID
    record_type_id INTEGER NOT NULL,             -- 记录类型ID
    require_location BOOLEAN DEFAULT 0,          -- 是否必需定位
    location_accuracy TEXT DEFAULT 'high',       -- 定位精度要求
    location_timeout INTEGER DEFAULT 30000,      -- 定位超时时间
    show_location_details BOOLEAN DEFAULT 1,     -- 是否显示位置详情
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- 创建时间
    FOREIGN KEY (record_type_id) REFERENCES record_types(id) ON DELETE CASCADE
);
~~~